<!DOCTYPE html>
<html>
<head>
  <title>Top Twitch Games</title>
  <link rel="stylesheet" type="text/css" href="lib/c3/c3.min.css" />
  <style type="text/css">
  html {
    height: 100%;
  }
  body {
    font: 10px sans-serif;
    height: 100%;
  }
  h1 {
    color: rgb(100, 65, 165);
  }
  #chart {
    height: 100%;
  }
  </style>
  <script type="text/javascript" src="lib/jquery/dist/jquery.min.js"></script>
  <script type="text/javascript" src="lib/d3/d3.min.js"></script>
  <script type="text/javascript" src="lib/c3/c3.min.js"></script>
</head>
<body>
  <h1>Top Games Being Watched on Twitch in the Past 24 Hours</h1>
  <div id="chart"></div>

  <script type="text/javascript">
  var url = 'http://seewes.com/twitch/api2.php';
  var chart;

  // Create initial graph
  $.get(url, function(json) {
    chart = c3.generate({
      data: {
        x: 'date',
        xFormat: '%Y-%m-%d %H:%M:%S',
        json: json.top,
        keys: {
          x: 'date',
          value: json.games,
        }
      },
      axis: {
        x: {
          type: 'timeseries',
          tick: {
            format: '%H:%M:%S',
          }
        },
        y: {
          label: 'Viewers',
        }
      },
      point: {
        show: false,
      },
      grid: {
        x: {
          show: true,
        },
        y: {
          show: true,
        }
      }
    });
  });

  // Load new graph data every minute
  setInterval(function() {
    $.get(url, function(json) {
      console.log(json.top);
      chart.load({
        x: 'date',
        xFormat: '%Y-%m-%d %H:%M:%S',
        json: json.top,
        keys: {
          x: 'date',
          value: json.games,
        }
      });
    });
  }, 60000);
  </script>
</body>
</html>